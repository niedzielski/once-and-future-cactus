!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.src=a.src||{})}(this,function(a){"use strict";var b=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},e=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},f=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},g=function(){function a(){b(this,a);for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];this._keys=d}return c(a,[{key:"pressed",value:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=this._keys[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(a.input.keyboard.isDown(g))return!0}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}return!1}}]),a}(),h=function(){function a(){b(this,a),this._up=new g(Phaser.Keyboard.UP,Phaser.Keyboard.W),this._right=new g(Phaser.Keyboard.RIGHT,Phaser.Keyboard.D),this._down=new g(Phaser.Keyboard.DOWN,Phaser.Keyboard.S),this._left=new g(Phaser.Keyboard.LEFT,Phaser.Keyboard.A)}return c(a,[{key:"up",value:function(a){return this._up.pressed(a)}},{key:"right",value:function(a){return this._right.pressed(a)}},{key:"down",value:function(a){return this._down.pressed(a)}},{key:"left",value:function(a){return this._left.pressed(a)}}]),a}(),i="lvl",j="static/lvl.json",k="tileset16",l="static/tileset.png",m=16,n=80,o=120,p=600,q=function(){function a(){b(this,a),this._map=null,this._tileLayers=[],this._kbd=new h}return c(a,[{key:"width",value:function(){return this._map&&this._map.widthInPixels}},{key:"height",value:function(){return this._map&&this._map.heightInPixels}},{key:"preload",value:function(a){a.load.tilemap(i,j,null,Phaser.Tilemap.TILED_JSON),a.load.spritesheet(k,l,m,m)}},{key:"create",value:function(a){a.physics.startSystem(Phaser.Physics.P2JS),a.physics.p2.gravity.y=p,this._map=a.add.tilemap(i),this._map.addTilesetImage(k);var b=!0,c=!1,d=void 0;try{for(var e,f=this._map.layers[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value,h=this._map.createLayer(g.name);this._tileLayers.push(h),h.resizeWorld()}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}var j=!0,l=!1,m=void 0;try{for(var n,o=Object.keys(this._map.objects)[Symbol.iterator]();!(j=(n=o.next()).done);j=!0){var q=n.value,r=this._map.objects[q],s=!0,t=!1,u=void 0;try{for(var v,w=r[Symbol.iterator]();!(s=(v=w.next()).done);s=!0){var x=v.value;this._map.createFromObjects(q,x.name,k,x.gid-1)}}catch(a){t=!0,u=a}finally{try{!s&&w.return&&w.return()}finally{if(t)throw u}}}}catch(a){l=!0,m=a}finally{try{!j&&o.return&&o.return()}finally{if(l)throw m}}this._loadCollisionBodies(a),a.camera.follow(this._player,Phaser.Camera.FOLLOW_PLATFORMER)}},{key:"update",value:function(a){var b=this._player.body.velocity;b.x=0,this._kbd.up(a)&&(b.y-=o),this._kbd.right(a)&&this._translatePlayerX(a,!1),this._kbd.down(a)&&(b.y+=o),this._kbd.left(a)&&this._translatePlayerX(a,!0)}},{key:"render",value:function(a){}},{key:"resize",value:function(a){var b=this;this._tileLayers.forEach(function(a){return a.resize(b.width(),b.height())}),a.camera.follow(this._player,Phaser.Camera.FOLLOW_PLATFORMER)}},{key:"_loadCollisionBodies",value:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=a.world.children[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if("player"===g.name){this._player=g;var h=51,i=this._findCollisionData(a,h);if(i){a.physics.p2.enable(g),g.body.clearShapes(),g.body.debug=!0;var j=!0,k=!1,l=void 0;try{for(var m,n=i[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var o=m.value,p=this._polylineToArray(o,o.polyline);g.body.loadPolygon(null,[{shape:p}])}}catch(a){k=!0,l=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw l}}}}}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}},{key:"_polylineToArray",value:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(b[d].x+a.x),c.push(b[d].y+a.y);return c}},{key:"_findCollisionData",value:function(a,b){var c=a.cache.getTilemapData(i),d=!0,e=!1,f=void 0;try{for(var g,h=c.data.tilesets[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var j=g.value,k=!0,l=!1,m=void 0;try{for(var n,o=Object.keys(j.tiles)[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){var p=n.value;if(p===""+b){var q=j.tiles[b];return q.objectgroup.objects}}}catch(a){l=!0,m=a}finally{try{!k&&o.return&&o.return()}finally{if(l)throw m}}}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return null}},{key:"_translatePlayerX",value:function(a,b){var c=200,d=b?-1:1;this._player.body.velocity.x=d*n,a.add.tween(this._player.scale).to({x:d},c,Phaser.Easing.Bounce.Out,!0)}}]),a}(),r=function(a){function g(a,c){b(this,g),console.log("GameState: constructor");var e=d(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,a));return e._scene=c,e}return e(g,a),c(g,[{key:"preload",value:function(a){var b=this;f(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"preload",this).call(this,a),console.log("GameState: preload"),a.time.advancedTiming=!0,a.renderer.renderSession.roundPixels=!0,a.camera.roundPx=!1,Phaser.Canvas.setImageRenderingCrisp(a.canvas),a.load.bitmapFont("mem","static/mem.png","static/mem.fnt"),a.load.bitmapFont("mem mono","static/mem.png","static/mem-mono.fnt"),window.addEventListener("resize",function(){return b.resize()}),this._scene.preload(a)}},{key:"create",value:function(a){f(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"create",this).call(this,a),console.log("GameState: create"),this._scene.create(a);var b=4;this._fpsText=a.add.bitmapText(1,1,"mem mono","0",b),this._fpsText.fixedToCamera=!0,this.resize();var c=20;a.add.bitmapText(c,1,"mem","Once & Future Cactus\nA Summary of You ~",b)}},{key:"update",value:function(a){f(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"update",this).call(this,a),this._scene.update(a)}},{key:"render",value:function(a){f(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"render",this).call(this,a),this._scene.render(a);var b=""+a.time.fps;this._fpsText.text=b.length<2?"0"+b:b}},{key:"resize",value:function(){var a=window.innerHeight/this._scene.height(),b=Math.floor(window.innerWidth/a),c=Math.floor(this._scene.height());console.log("GameState: resize scale="+a+" "+("native="+b+"x"+c+" ")+("scene="+this._scene.width()+"x"+this._scene.height()+" ")+("window="+window.innerWidth+"x"+window.innerHeight+" ")+("ratio="+window.innerWidth/window.innerHeight)),this.game.scale.setGameSize(b,c),this.game.camera.bounds=new Phaser.Rectangle(0,0,this._scene.width(),this._scene.height()),this._scene.resize(this.game)}}]),g}(Phaser.State),s=function(a){function f(){b(this,f);var a=d(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,{transparent:!1,antialias:!1,renderer:Phaser.AUTO}));return a._gameState=new r(a,new q),a}return e(f,a),c(f,[{key:"init",value:function(){this.state.add("GameState",this._gameState,!0)}}]),f}(Phaser.Game);(new s).init(),Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map